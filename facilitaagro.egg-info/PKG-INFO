Metadata-Version: 2.4
Name: facilitaagro
Version: 0.1.0
Summary: Pipeline geoespacial para interpolaÃ§Ã£o de dados agrÃ­colas e integraÃ§Ã£o via FastAPI
Author-email: Exata <exata@exata.com>
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: fastapi
Requires-Dist: uvicorn
Requires-Dist: python-multipart
Requires-Dist: numpy
Requires-Dist: pandas
Requires-Dist: geopandas
Requires-Dist: shapely
Requires-Dist: rasterio
Requires-Dist: matplotlib
Requires-Dist: scikit-learn
Requires-Dist: scipy
Requires-Dist: pykrige
Requires-Dist: libpysal
Requires-Dist: esda
Requires-Dist: scikit-gstat
Requires-Dist: pydantic
Provides-Extra: dev
Requires-Dist: ipykernel; extra == "dev"
Requires-Dist: jupyter; extra == "dev"

# ğŸ“˜ README â€” Facilita Agro API & Pipelines Geoespaciais

## VisÃ£o Geral

MÃ³dulos do **Facilita Agro** para processamento automatizado de:

- Amostragens de solo  
- Amostragens foliares  
- Amostragens de compactaÃ§Ã£o  
- Amostragens de nematoides  
- Mapas de produtividade (mÃ³dulo â€œproduÃ§Ã£oâ€)  

Cada mÃ³dulo passa por:

1. **Carregamento do CSV**  
2. **ValidaÃ§Ã£o e detecÃ§Ã£o das colunas padronizadas**  
3. **ConversÃ£o espacial e reprojeÃ§Ã£o**  
4. **InterpolaÃ§Ã£o (IDW ou Kriging, com escolha automÃ¡tica)**  
5. **GeraÃ§Ã£o de rasters GeoTIFF**  
6. **Amostragem dos valores na grade da lavoura**  
7. **ExportaÃ§Ã£o de CSVs por processo (`csv_solo`, `csv_prod`, â€¦)**  
8. **ConstruÃ§Ã£o incremental do grid completo (`grid_completo.csv`)**

A API fornece endpoints para rodar os pipelines diretamente via upload de CSV.

---

# ğŸ“ Estrutura do Projeto

```
facilita-agro/
â”‚
â”œâ”€â”€ facilita_agro/               # LÃ³gica dos pipelines
â”‚   â”œâ”€â”€ analise_espacial.py
â”‚   â”œâ”€â”€ interpolador.py
â”‚   â”œâ”€â”€ processador_amostragem.py
â”‚   â”œâ”€â”€ pipeline_completa.py
â”‚   â”œâ”€â”€ pipeline_yield.py
â”‚   â”œâ”€â”€ grid_completo.py
â”‚   â”œâ”€â”€ logger.py
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ api/                         # FastAPI
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ main.py
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ contornos/               # KML/SHP por lavoura (entrada)
â”‚   â”œâ”€â”€ amostragem/              # CSVs de solo/foliar/compac/nemat
â”‚   â””â”€â”€ yield/                   # CSVs de produtividade
â”‚
â”œâ”€â”€ outputs/
â”‚   â”œâ”€â”€ rasters_amostragem/      # GeoTIFFs gerados
â”‚   â”œâ”€â”€ rasters_yield/
â”‚   â”œâ”€â”€ csv/                     # csv_solo, csv_prod, ...
â”‚   â””â”€â”€ csv_grid_completo/       # grid consolidado por lavoura
â”‚
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

---

# Rodando localmente

## 1. Criar ambiente

```bash
conda create -n facilita python=3.11
conda activate facilita
pip install -r requirements.txt
```

## 2. Rodar a API

```bash
uvicorn api.main:app --reload --port 8000
```

Abrir no navegador:

- Swagger UI â†’ http://127.0.0.1:8000/docs  
- Health check â†’ http://127.0.0.1:8000/health  

---

# ğŸ³ Rodando via Docker

## Build da imagem

```bash
docker build -t facilita-agro .
```

## Rodar o container

```bash
docker run -p 8000:8000 -v $(pwd)/data:/app/data -v $(pwd)/outputs:/app/outputs facilita-agro
```

A API estarÃ¡ disponÃ­vel em:

```
http://localhost:8000
```

---

# Estrutura dos Arquivos de Entrada

## 1. Contorno da Lavoura
Um arquivo por lavoura:

```
data/contornos/<lavoura>.kml
ou
data/contornos/<lavoura>.shp
```

## 2. Amostragem por processo
Arquivos CSV com colunas padronizadas.

### Comuns:
`Data, Cliente, Fazenda, TalhÃ£o, Gleba, Lat, Long`

### Solo:
`pH H2O, K, Ca, Mg, MO, Argila, ...`

### Foliar:
`N, P, K, Ca, Mg, S, B, Cu, Fe, Mn, Zn`

### CompactaÃ§Ã£o:
`Profundidade, Kpa`

### Nematoide:
`EspÃ©cie, Quantidade, U/100cc`

## 3. Produtividade (yield)
Colunas obrigatÃ³rias:
- `Kg/Ha`
- `MÃ©dia de produÃ§Ã£o Kg/Ha (BalanÃ§a)`  
- `Lat, Long, Data`

---

# ğŸŒ API â€” Endpoints

## ğŸ” Health Check

```
GET /health
```

---

## Processar Amostragem (solo/foliar/compac/nemat)

### Endpoint Upload:

```
POST /processar-amostragem-upload
```

Campos:
- `lavoura`  
- `processo`: `"solo"`, `"foliar"`, `"compac"`, `"nemat"`  
- `arquivo_csv`  
- `atualizar_grid_completo`

Retorna:
```json
{
  "sucesso": true,
  "caminho_csv_grid": "...",
  "caminho_csv_grid_completo": "...",
  "colunas": [...]
}
```

---

## Processar Yield (Produtividade)

```
POST /processar-yield-upload
```

Corrige a mÃ©dia pelo valor da balanÃ§a e realiza Kriging (ou IDW fallback).

---

## Atualizar grid completo

```
POST /atualizar-grid-completo
```

---

# Estrutura do grid completo

Colunas fixas:

`id_ponto, Cliente, Fazenda, TalhÃ£o, Gleba, Lat, Long`

Colunas de data por processo:

`Data_solo, Data_prod, Data_foliar, Data_compac, Data_nemat`

Atributos:

`K_solo`, `MO_solo`, `Ca_foliar`, `Kg/Ha_prod`, etc.

---

# Funcionamento Interno

### ğŸ”¹ InterpolaÃ§Ã£o automÃ¡tica
- Teste de dependÃªncia espacial
- Variograma
- SeleÃ§Ã£o de algoritmo

### ğŸ”¹ Ajuste estatÃ­stico da produtividade
`Kg/Ha` Ã© recalibrado pela balanÃ§a.

### ğŸ”¹ Grade fixa
Gerada a partir do contorno da lavoura.

---

# âœ”ï¸ Pronto para ProduÃ§Ã£o
- API estÃ¡vel  
- Pipelines consolidados  
- Grid completo padronizado  
- Docker operacional  

---

